---
slug: 'slowly-upgrading-react'
date: '2018-12-29'
title: 'Slowly upgrading react'
categories: ['en']
banner: ''
draft: false
---

## Every major upgrade of the framework your app runs at carry a risk.

You can have all unit and integrations tests passing, but if your app is big enough and serving millions of customers, you will probably not feel comfortable shipping major upgrade of React to all customers at once.

If you are using webpack and Yarn, you can easily create two bundles of your app with different React version and test the bundle with new React version only for small percentage of your customers.

If your package.json looks like this:

```json!package.json
{
  "dependencies": {
    "react": "15.6.2",
    "react-dom": "15.6.2"
  }
}
```

You can install next React version together with your current one with Yarn aliases:

```json!package.json
{
  "dependencies": {
    "react": "15.6.2",
    "react-16": "npm:react@16.7.0",
    "react-dom": "15.6.2",
    "react-dom-16": "npm:react-dom@16.7.0"
  }
}
```

Now you can use `import React from 'react-16'` to import the new version of React. This can be automated with Webpack resolve alias.

Simplified version of Webpack config might looks like:

```js!webpack.config.js
module.exports = {
  entry: {
    index: ['./app/index.js'],
  },
};
```

Using Webpack resolve alias for another entry we can create two bundles of the same app with different React version:

```js!webpack.config.js
const baseConfig = {
  entry: {
    entry: ['./app/index.js'],
  },
};

module.exports = [
  baseConfig,
  {
    ...baseConfig,
    entry: {
      entry_react_16: ['./app/index.js'],
    },
    resolve: {
      alias: {
        react: 'react-16',
        'react-dom': 'react-dom-16',
      },
    },
  },
];
```

This will create new `entry_react_16` bundle in addition to our original `entry` bundle and now it's just up to you how you are gonna decide to serve it.

If you are using error tracking software like [sentry](https://sentry.io), it's also a good idea to add tag to each event:

```js
Sentry.configureScope(scope => {
  scope.setTag('react.version', React.version);
});
```
